<script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<model-viewer id="ar-view" src="model.glb" ar camera-controls style="width:100%; height:90vh;">
    <button slot="ar-button" style="position:absolute; bottom:20px; left:50%; transform:translateX(-50%);">ARを開始</button>
</model-viewer>

<script>
    const viewer = document.querySelector("#ar-view");
    const socket = io("https://webartest.onrender.com", {
        transports: ["websocket"] // Renderでの接続を安定させる
    });

    socket.on("ar_control", (data) => {
        if (data.type === "color") {
            // UE5から持ってきたマテリアルの色をリアルタイム変更
            const color = data.value; // [R, G, B, A]
            viewer.model.materials[0].pbrMetallicRoughness.setBaseColorFactor(color);
        }
        if (data.type === "anim") {
            // UE5で設定したアニメーション名を指定
            viewer.animationName = data.name;
            viewer.play();
        }
    });
</script>
